using System;

namespace LearnStructuredProgramming.Section00_UnstructuredProgramming
{
  /// <summary>
  /// カメ vs ワニゲーム - 非構造化プログラミング議論版
  ///
  /// ■ 教育目的
  /// このクラスは「非構造化プログラミング」の基本的な特徴を示す入門用サンプルです。
  /// グローバル変数（静的フィールド）の使用と、手続き的なプログラミングの問題点を
  /// 体験することができます。
  ///
  /// ■ 非構造化プログラミングの特徴（このサンプルで示すもの）
  /// - グローバル変数（クラスレベルの静的変数）への依存
  /// - 関数間での暗黙的なデータ共有
  /// - 状態管理の分散（どこで何が変更されるか追跡困難）
  /// - 処理の順序に強く依存したロジック
  ///
  /// ■ このコードの問題点
  /// 1. 静的変数 kamePos, waniPos, kame_wani_distance がどこからでもアクセス可能
  /// 2. MoveKame() と MoveWani() がグローバル状態を直接変更
  /// 3. 関数呼び出しの順序が重要（kame_wani_distanceの計算タイミング）
  /// 4. テストやデバッグが困難
  ///
  /// ■ ゲームルール
  /// - カメ🐢: ワニとの距離が2より大きければ歩く、2以下なら手足を引っ込める
  /// - ワニ🐊: 毎ターン1マスずつカメに近づく
  /// - ワニがカメに追いつくとゲームオーバー
  ///
  /// ■ 次のステップ
  /// Section01_UnstructuredProgramming では、goto文を使用したより極端な
  /// 非構造化プログラミングの例を学びます。
  /// </summary>
  public class TurtleVsCrocodileGame
  {
    // =========================================================================
    // グローバル変数（静的フィールド）
    // -------------------------------------------------------------------------
    // 問題点: これらの変数はクラス内のどのメソッドからもアクセス・変更可能。
    // どのメソッドがいつ値を変更するか追跡するのが困難になります。
    // =========================================================================

    /// <summary>
    /// カメの現在位置
    /// </summary>
    static int kamePos = 0;

    /// <summary>
    /// ワニの現在位置
    /// </summary>
    static int waniPos = 10;

    /// <summary>
    /// カメとワニの距離
    /// 注意: この値は毎ループの最初に計算される必要がある
    /// </summary>
    static int kame_wani_distance = 0;

    /// <summary>
    /// ゲームのメインループを実行する
    /// </summary>
    public void Run()
    {
      // =========================================================================
      // メインループ
      // -------------------------------------------------------------------------
      // whileループで10回の繰り返し処理を行う。
      // 各イテレーションで以下の処理を順番に実行:
      // 1. 距離計算 → 2. カメ移動 → 3. ワニ移動 → 4. 衝突判定
      // =========================================================================

      int i = 0;
      while (i < 10)
      {
        // -----------------------------------------------------------------
        // ステップ1: カメとワニの距離を求める
        // -----------------------------------------------------------------
        // Math.Abs() を使用して絶対値を取得することで、
        // 位置関係に関わらず正しい距離を計算できる
        kame_wani_distance = Math.Abs(kamePos - waniPos);

        // -----------------------------------------------------------------
        // ステップ2-3: キャラクターの移動処理
        // -----------------------------------------------------------------
        // 注意: MoveKame() は kame_wani_distance の値に依存するため、
        // 距離計算の後に呼び出す必要がある（順序依存性の問題）
        MoveKame(); // カメを動かす
        MoveWani(); // ワニを動かす

        // -----------------------------------------------------------------
        // ステップ4: 衝突判定
        // -----------------------------------------------------------------
        // カメとワニが同じ位置にいるかチェック
        if (kamePos == waniPos)
        {
          Console.WriteLine("カメは食べられてしまった");
          break;  // ループを抜ける（ゲームオーバー）
        }

        // ゲームのテンポ調整（1秒待機）
        System.Threading.Thread.Sleep(1000);
        Console.WriteLine();
        i++;
      }

      // ゲーム終了後、ユーザーの入力を待つ
      Console.Read();
    }

    /// <summary>
    /// カメの状況を判定し、動かす
    /// </summary>
    /// <remarks>
    /// 問題点:
    /// - グローバル変数 kame_wani_distance を直接参照している
    /// - グローバル変数 kamePos を直接変更している
    /// - このメソッドが呼ばれる前に kame_wani_distance が
    ///   正しく計算されていることを前提としている（暗黙の契約）
    /// </remarks>
    static void MoveKame()
    {
      // ワニとの距離が2より大きい場合は安全と判断して前進
      if (kame_wani_distance > 2)
      {
        kamePos++;
        Console.WriteLine("カメは歩く");
      }
      // ワニが近い場合は防御態勢
      else if (kame_wani_distance <= 2)
      {
        Console.WriteLine("カメは手足を引っ込める");
      }
    }

    /// <summary>
    /// ワニを動かす
    /// </summary>
    /// <remarks>
    /// 問題点:
    /// - グローバル変数 waniPos を直接変更している
    /// - ワニの行動ロジックが単純すぎて拡張困難
    ///   （例: カメの位置に応じた行動変化の追加が難しい）
    /// </remarks>
    static void MoveWani()
    {
      waniPos--;
      Console.WriteLine("ワニは歩く");
    }
  }
}
